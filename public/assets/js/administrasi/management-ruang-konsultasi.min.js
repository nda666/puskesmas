$(document).ready(function(a){function t(){$(".tambah-btn").attr("data-content","Pendaftaran anggota Baru?"),$(".colvis-btn").attr("data-content","Tampilkan / sembunyikan cell tabel"),$(".refresh-btn").attr("data-content","Refresh tabel"),$(".search-btn").attr("data-content","Tampilkan / sembunyikan kolom pencarian"),$(".clear-search-btn").attr("data-content","Bersihkan field pencarian"),$(".copy-btn").attr("data-content","Salin data tabel"),$(".print-btn").attr("data-content","Cetak tabel"),$(".csv-btn").attr("data-content","Simpan ke CSV"),$(".excel-btn").attr("data-content","Simpan ke Excel"),$(".reset-colorder-btn").attr("data-content","Kembalikan posisi kolom head tabel"),$(".ui.button").popup()}function e(a){$("#ubah-data form").addClass("loading"),$.ajax({url:a,type:"GET",dataType:"json",success:function(a){a[0]&&n(a[0])},error:function(a){noty({layout:"topRight",text:"Error: "+a.status+" "+a.statusText+"<br>Coba refresh browser kembali, apabila pesan ini masih muncul silahkan hubungi Administrator",type:"warning"});$("#ubah-data").modal("hide")},complete:function(){$("#ubah-data form").removeClass("loading")}})}function n(a){return $.each(a,function(a,t){$('#ubah-data form [name="'+a+'"]').val(t)}),$("#ubah-data form .ui.dropdown").dropdown(),$("#ubah-data form").removeClass("loading"),!0}var i=$("#data-ruang-konsultasi").DataTable({ajax:{url:$("#data-ruang-konsultasi").data("source")},language:{url:$("#data-ruang-konsultasi").data("lang")},lengthMenu:[[15,20,100,200,500,-1],[15,20,100,200,500,"Semua"]],colReorder:!0,searchDelay:1e3,stateSave:!0,scrollX:!0,scrollY:"60vh",scrollCollapse:!0,select:{style:"os",items:"row"},dom:"<'left no padding-bottom floated aligned four wide computer column'l><'right no padding-bottom aligned twelve wide computer column'f><'ui button-container sixteen wide column'<'ui toolbars segment'>><'sixteen wide column no padding top bottom'tr><'left aligned four wide column'i><'right aligned twelve wide column'p>",processing:!0,pagingType:"full_numbers",serverSide:!0,filter:!0,sort:!0,info:!0,columns:[{data:"id",name:"rawat_jalan.id"},{data:"pasien_id",name:"pasien.id"},{data:"nama",name:"pasien.nama"},{data:"kepala_keluarga",name:"pasien.kepala_keluarga"},{data:"no_kartu_keluarga",name:"pasien.no_kartu_keluarga"},{data:"pekerjaan",name:"pasien.pekerjaan"},{data:"tgl_lahir",name:"pasien.tgl_lahir",searchable:!1},{data:"agama",name:"pasien.agama"},{data:"jenis_kelamin",name:"pasien.jenis_kelamin"},{data:"alamat",name:"pasien.alamat"},{data:"kepesertaan",name:"rawat_jalan.kepesertaan"},{data:"kunjungan",name:"rawat_jalan.kunjungan"}],drawCallback:function(){}});i.on("init.dt",function(){yadcf.init(i,[{column_number:0,filter_type:"text"},{column_number:1,filter_type:"text"},{column_number:2,filter_type:"text"},{column_number:3,filter_type:"text"},{column_number:4,filter_type:"text"},{column_number:6,filter_type:"range_date",date_format:"yyyy-mm-dd"},{column_number:5,filter_type:"text"},{column_number:7,filter_type:"select",data:[{value:"Islam",label:"Islam"},{value:"Kristen",label:"Kristen"},{value:"Katholik",label:"Katholik"},{value:"Hindu",label:"Hindu"},{value:"Budha",label:"Budha"},{value:"Lain-Lain",label:"Lain-Lain"}]},{column_number:8,filter_type:"select",data:[{value:"Laki-Laki",label:"Laki-Laki"},{value:"Perempuan",label:"Perempuan"}]},{column_number:9,filter_type:"text"},{column_number:10,filter_type:"text"}]),$(".yadcf-filter-wrapper").addClass("ui small action datatables-search input").css({display:"flex"}),$(".yadcf-filter-wrapper button").html('<i class="close icon"></i>'),$(".yadcf-filter-wrapper button").addClass("ui small icon button"),$("[id^=yadcf]").hide(),new $.fn.dataTable.Buttons(i,{dom:{container:{tag:"div",className:"ui small buttons"},collection:{tag:"div",className:"dt-button-collection"},button:{tag:"a",className:"ui tiny icon button",active:"active",disabled:"disabled"},buttonLiner:{tag:"span",className:""}},buttons:[{text:'<i class="plus icon"></i>Tambah',className:"primary icon tambah-btn",action:function(a,t,e,n){$('#pendaftaran-baru form [name="id"]').val(""),$("#pendaftaran-baru form").form("clear"),$('#pendaftaran-baru form input[type="hidden"][name="_token"]').val($("#pendaftaran-baru form").attr("data-token")),$("#pendaftaran-baru .header").text("Tambah Data Pasien"),$("#pendaftaran-baru").modal({closable:!1,onApprove:function(){return l("#pendaftaran-baru form",!0,function(){$("#rawat-jalan-field").hide()}),!1},onHidden:function(){$("#rawat-jalan-field").hide()}}).modal("show")}},{text:'<i class="treatment icon"></i>Daftarkan',className:"positive icon rwt-jln-btn disabled",action:function(a,t,e,n){var i=t.row({selected:!0}).data();return i?void $("#daftar-rawat-jalan").modal({onShow:function(){$('#daftar-rawat-jalan form [name="_token"]').val($("#daftar-rawat-jalan form").attr("data-token")),$('#daftar-rawat-jalan form [name="pasien_id"]').val(i.id),$('#daftar-rawat-jalan form [name="nama"]').val(i.nama),$("#daftar-rawat-jalan form .ui.dropdown").dropdown("restore defaults")},onApprove:function(){return l("#form-rawat-jalan",!0,function(){$("#daftar-rawat-jalan").modal("hide")}),!1}}).modal("show"):!1}},{text:'<i class="edit icon"></i>Ubah',className:"orange ubah-btn disabled",action:function(a,t,n,i){var o=t.row({selected:!0}).data();return o?($("#ubah-data .header").text("Ubah Data Pasien - ID: "+o.id),$("#ubah-data form").form("clear"),$('#ubah-data form input[type="hidden"][name="_token"]').val($("#ubah-data form").attr("data-token")),$("#ubah-data").modal({closable:!1,onApprove:function(){return l("#ubah-data form"),!1}}).modal("show"),void e("/administrasi/pendaftaran/data-pasien/"+o.id)):!1}},{text:'<i class="trash icon"></i>Hapus',className:"disabled negative hapus-btn",action:function(a,t,e,n){var i=t.rows({selected:!0}).data();if(i.length<=0)return!1;var o=new Array;$.each(i,function(a,t){o.push(t.id)}),delete_data_pasien(o)}}]}),new $.fn.dataTable.Buttons(i,{dom:{container:{tag:"div",className:"ui small buttons"},collection:{tag:"div",className:"dt-button-collection"},button:{tag:"a",className:"ui toggle tiny icon button",active:"active",disabled:"disabled"},buttonLiner:{tag:"span",className:""}},buttons:[{extend:"colvis",className:"colvis-btn",text:'<i class="icon eye"></i>',postfixButtons:["colvisRestore"]},{text:'<i class="icon refresh"></i>',className:"refresh-btn",action:function(a,t,e,n){i.ajax.reload()}},{text:'<i class="clockwise rotated search icon"></i>',className:"search-btn",action:function(a,t,e){$(e).toggleClass("active").removeClass("toggle"),$(e).hasClass("active")?$("[id^=yadcf]").show():$("[id^=yadcf]").hide(),i.columns.adjust()}},{text:'<i class="icons"><i class="undo icon"></i><i class="search black corner icon"></i></i>',className:"clear-search-btn",action:function(a,t,e){yadcf.exResetAllFilters(i),i.columns.adjust()}},{text:'<i class="list layout icon"></i>',className:"reset-colorder-btn",action:function(){i.colReorder.reset()}}]}),new $.fn.dataTable.Buttons(i,{dom:{container:{tag:"div",className:"ui small buttons"},collection:{tag:"div",className:"dt-button-collection"},button:{tag:"a",className:"ui tiny icon button",active:"active",disabled:"disabled"},buttonLiner:{tag:"span",className:""}},buttons:[{extend:"copyHtml5",className:"copy-btn",text:'<i class="icon copy"></i>',exportOptions:{columns:":visible"}},{extend:"print",text:'<i class="icon print"></i>',className:"print-btn",message:"List pendaftar hari ini.",exportOptions:{columns:":visible"}},{extend:"csvHtml5",className:"csv-btn",text:'<i class="icon file text outline"></i>',exportOptions:{columns:":visible"}},{extend:"excelHtml5",className:"excel-btn",text:'<i class="icon excel file outline"></i>',exportOptions:{columns:":visible"}}]}),i.buttons(0,1).container().prependTo($(".toolbars"))});var o=setTimeout(function(){t(),clearTimeout(o)},1e3);i.on("select",function(a,t,e,n){$(".ubah-btn, .hapus-btn, .rwt-jln-btn").removeClass("disabled"),$(".rwt-jln-btn").attr("data-content","Daftarkan "+t.row(n).data().id+":"+t.row(n).data().nama+" untuk Rawat Jalan?"),$(".hapus-btn").attr("data-content","Hapus ke anggotaan "+t.row(n).data().id+":"+t.row(n).data().nama+"?"),$(".ubah-btn").attr("data-content","Ubah data ke anggotaan "+t.row(n).data().id+":"+t.row(n).data().nama+"?")}).on("deselect",function(a,t,e,n){$(".ubah-btn, .hapus-btn, .rwt-jln-btn").addClass("disabled")}),$('[name="tgl_lahir"]').inputmask("dd-mm-yyyy"),$(".ui.button").popup(),$("#jenis_kunjungan_dropdown").dropdown(),$("#jenis_kelamin_dropdown").dropdown(),$("#agama_dropdown").dropdown(),$("#kepesertaan-dropdown").dropdown({onChange:function(a,t,e){0==a?$('[name="_jenis_kepesertaan"]').parent().fadeIn():($('[name="_jenis_kepesertaan"]').parent().fadeOut(),$('[name="_jenis_kepesertaan"]').val(""))}}),$("#form-pendaftaran").form({on:"submit",keyboardShortcuts:!1,inline:!0,fields:{nama:["minLength[3]","maxLength[50]","empty"],kepala_keluarga:["minLength[3]","maxLength[50]","empty"],no_kartu_keluarga:["minLength[6]","maxLength[50]","empty","number"],jenis_kelamin:["empty"],alamat:"empty",pekerjaan:["minLength[3]","maxLength[50]","empty"],tgl_lahir:["empty","regExp[/[0-9]{2}-[0-9]{2}-[0-9]{4}/]"],agama:["empty","agama"],jenis_kepesertaan:"emptyif[daftar_rawat_jalan:checked]"}}),$("#form-pendaftaran input").on("keydown",function(a){var t=a.which;return 13===t?!1:void 0}),$("#form-pendaftaran").on("change","#daftar_rawat_jalan",function(a){$("#rawat-jalan-field .ui.dropdown").dropdown("restore defaults"),$(this).is(":checked")?$("#rawat-jalan-field").show():$("#rawat-jalan-field").hide()}),$("#form-ubah").form({on:"submit",keyboardShortcuts:!1,inline:!0,fields:{nama:["minLength[3]","maxLength[50]","empty"],kepala_keluarga:["minLength[3]","maxLength[50]","empty"],no_kartu_keluarga:["minLength[6]","maxLength[50]","empty","number"],jenis_kelamin:["empty"],alamat:"empty",pekerjaan:["minLength[3]","maxLength[50]","empty"],tgl_lahir:["empty","regExp[/[0-9]{2}-[0-9]{2}-[0-9]{4}/]"],agama:["empty","agama"]}}),$("#form-rawat-jalan").form({on:"submit",keyboardShortcuts:!1,inline:!0,fields:{jenis_kepesertaan:"empty"}});var l=function(a,t,e){return $(a).unbind("submit"),$(a).submit(function(n){if($(a).hasClass("loading")||!$(a).form("is valid")||!global_form)return!1;global_form=!1;var i=$(a).attr("action"),o=$(a).serialize(),l=$(a);noty({text:"Simpan data?",buttons:[{addClass:"ui positive small button",text:'<i class="icon save"></i>Simpan',onClick:function(a,n){l.addClass("loading"),$(this).addClass("disabled"),$(this).parent().find(".negative").addClass("disabled");var r=$(this),s=$(this).parent().find(".negative");a.setText('<i class="icon asterisk loading"></i>Mohon tunggu sebentar'),$.ajax({url:i,type:"POST",dataType:"json",data:o,success:function(n){if(n&&n.response){noty({layout:"topRight",text:n.message,type:"success"});t&&(l.form("clear"),l.find('[name="_token"]').val(l.attr("data-token"))),e&&e(),a.close()}else if(n&&!n.response){a.close();noty({layout:"topRight",text:n.message,type:"warning"})}},error:function(t){if(422==t.status){a.close();var e=$.parseJSON(t.responseText),n="<b>Form Validasi: </b>";n+='<ul style="text-align: left;">',$.each(e,function(a,t){Array.isArray(t)?$.each(t,function(a,t){n+="<li>"+t+"</li>"}):n+="<li>"+t+"</li>"}),n+="</ul>";noty({layout:"topRight",text:n,type:"warning"});return!1}a.setText("Simpan data?");noty({layout:"topRight",text:"Error: "+t.status+" "+t.statusText+"<br>Coba refresh browser kembali, apabila pesan ini masih muncul silahkan hubungi Administrator",type:"error"})},complete:function(){l.removeClass("loading"),r.removeClass("disabled"),s.removeClass("disabled"),global_form=!0}})}},{addClass:"ui negative small button",text:"Cancel",onClick:function(a){a.close(),global_form=!0}}],modal:!0,layout:"center"});n.preventDefault()}),$(a).submit()}});